function anime(t,e,n){var e=e.length?e:[e],o=t.el||t,i=Date.now();return e.forEach(function(t){return o.style[t.style]=""+t.start+t.unit}),o.style.display="",new Promise(function(t,r){function s(){var r=Date.now()-i;r<n?(e.forEach(function(t){return o.style[t.style]=""+(t.start+(t.end-t.start)*(r/n))+t.unit}),requestAnimationFrame(s)):(e.forEach(function(t){return o.style[t.style]=""+t.end+t.unit}),t())}requestAnimationFrame(s)})}function start(){var t=$$("#menu"),e=$$("#loading");return e.fadeOut(250).then(function(){e.remove(),t.fadeIn(250),$$("#zoom-container .item-image").on("click",function(){$$("#zoom-container").fadeOut(100)})}),new Promise(function(e){$$("#menu .button").on("click",function(){var n=$$("h1");n.fadeOut(250),t.fadeOut(250).then(function(){t.remove(),n.addClass("small").fadeIn(250),e()})})})}function foo(t){start().then(function(){return console.log(new Collection(t.data))})}function createZoom(t,e){$$("#zoom-container .item-image").html(t.data),$$("#download a").setAttr({href:"https://yusai.github.io/design-collection/"+t.path,download:t.name,target:"_blank"}),zoomEvent.anime(e)}function $$(t){return new C(t)}var Collection=function(){function t(t){var e=this;return this.data=t,this.setRows(),this.waypoint=new Waypoint("#waypoint"),this.infinit=!1,this.fill=!1,window.addEventListener("orientationchange",function(){e.orient()}),this.start(),this}return t.prototype.start=function(){var t=this;console.log("start"),this.waypoint.move(),$$("#main").fadeIn(250).then(function(){t.restart()})},t.prototype.restart=function(){this.index=0,this.addStop=!1,this.loaded=!1,this.waypoint._on(),scrollEvent.on(this),$$("#rows-container").removeClass("stretch"),this.addItem()},t.prototype.orient=function(){$$("#rows-container").html(),this.setRows(),this.restart()},t.prototype.setRows=function(){var t=Math.floor(window.innerWidth/160)||1,e=Math.floor(this.data.length/(window.innerHeight>window.innerWidth?4:3));t>e&&(t=e);for(var n=$$("#rows-container"),o=$$("$$ul").addClass("item-container").el,i=0;i<t;i++)n.append(o.cloneNode())},t.prototype.check=function(){return this.index<this.data.length},t.prototype.addItem=function(){var t=this;if(!this.fill&&this.addStop&&this.loaded&&!this.infinit)return this.waypoint.off(),!1;var e=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;return this.waypoint.top()-e+12<window.innerHeight&&(this.loadItem().then(function(){t.waypoint.move(),t.addItem()||(console.log("addItem stop"),t.addStop=!0,t.fill&&t.loaded&&!t.infinit&&t.waypoint.off())},function(){t.infinit||t.fill||(console.log("item loaded"),t.waypoint.off())}),!0)},t.prototype.loadItem=function(){function t(t){return new Promise(function(e,o){var i=new XMLHttpRequest;i.open("get",t.download_url,!0),i.onload=function(o){i.status>=200&&i.status<400?(console.log("SVG Loaded : "+n),t.data=i.responseText):(console.log("File Not Found : "+n),t.data="image not found"),e()},i.send(null)})}var e=this,n=this.index,o=this.getJSON();return o?new Promise(function(n,i){function r(t){var o=$$("$$dd").addClass("item-image");if("image not found"==t.data)return console.log("no image..."),void(e.check()?n():i());var r=$$("$$dl").addClass("small"),s=$$("$$li").addClass("item").hide();e.waypoint.before(s.append(r.append(o))),o.html(t.data),o.on("click",function(e){createZoom(t,e)}),e.showItem(s).then(n,i)}o.data?r(o):t(o).then(function(){r(o)})}):(console.log("check"),Promise.reject("no json"))},t.prototype.showItem=function(t){var e=this;return new Promise(function(n,o){t.fadeIn(5).then(function(){e.check()?n():o()})})},t.prototype.getJSON=function(){var t;return this.check()?(t=this.data[this.index],this.index++,this.index!=this.data.length||this.loaded||(console.log("svg files loaded"),this.loaded=!0),this.loaded&&this.addStop&&(this.fill=!1),(this.infinit||this.fill)&&this.index>=this.data.length&&(this.index=0)):t=!1,t},t}(),scrollEvent={on:function(t){this.func=function(){t.addItem()},window.addEventListener("scroll",this.func,!1)},off:function(){window.removeEventListener("scroll",this.func,!1)}},zoomEvent={anime:function(t){var e=t.pageX,n=t.pageY-document.body.scrollTop,o=[{style:"top",start:n,end:0,unit:"px"},{style:"left",start:e,end:0,unit:"px"},{style:"width",start:0,end:100,unit:"%"},{style:"height",start:0,end:100,unit:"%"}];anime($$("#zoom-container"),o,100)}},C=function(){function t(t){this.selector=t,this.el=function(t){function e(n){if(0==t.length)return n;var o=t.shift();return 2==o.split("#").length?e(n.getElementById(o.split("#")[1])):2==o.split(".").length?n.getElementsByClassName(o.split(".")[1]):n.getElementsByTagName(o)}if(2==t.split("$$").length)return document.createElement(t.split("$$")[1]);var t=t.split(" ");return e(document)}(t)}return t.prototype.addClass=function(t){if(this.el.length>0)for(var e=0;e<this.el.length;e++)this.el[e].classList.add(t);else this.el.classList.add(t);return this},t.prototype.removeClass=function(t){return this.el.classList.remove(t),this},t.prototype.setAttr=function(t){function e(t,e){for(var n in e){var o=e[n];t.setAttribute(n,o)}}if(this.el.length>0)for(var n=0;n<this.el.length;n++)e(this.el[n],t);else e(this.el,t);return this},t.prototype.children=function(t){return this.el=isFinite(t)&&this.el.childNodes[t]||this.el.childNodes,this},t.prototype.html=function(t){function e(t,e){t.innerHTML=e||""}if(this.el.length>0)for(var n=0;n<this.el.length;n++)e(this.el[n],t);else e(this.el,t);return this},t.prototype.remove=function(){return this.el.parentNode.removeChild(this.el),this},t.prototype.hide=function(){return this.el.style.display="none",this},t.prototype.show=function(){return this.el.style.display="",this},t.prototype.append=function(t){return this.el.appendChild(t.el||t),this},t.prototype.length=function(){return this.el.length},t.prototype.on=function(t,e){function n(t,e,n){t.addEventListener(e,n)}if(this.el.length>0)for(var o=0;o<this.el.length;o++)n(this.el[o],t,e);else n(this.el,t,e);return this},t.prototype.before=function(t){return this.el.parentNode.insertBefore(t.el||t,this.el),this},t.prototype.offset=function(){var t=this.el.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}},t.prototype.fade=function(t,e){function n(t,e,n){n&&(t.style.opacity=0,t.style.display="");var o=[{style:"opacity",start:n?0:1,end:n?1:0,unit:""}];return anime(t,o,e).then(function(){t.style.opacity="",!n&&(t.style.display="none")})}var o;return o=this.el.length?Promise.all(Array.prototype.slice.call(this.el).map(function(o){return n(o,t,e)})):n(this.el,t,e)},t.prototype.fadeIn=function(t){return this.fade(t,!0)},t.prototype.fadeOut=function(t){return this.fade(t,!1)},t.prototype.eq=function(t){return this.el=this.el[t],this},t}(),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Waypoint=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._on=function(){this.show()},e.prototype.off=function(){scrollEvent.off(),this.hide();for(var t=$$("#rows-container ul"),e=Math.max(window.innerHeight,Math.max.apply(null,Array.prototype.slice.call(t.el).map(function(t){return t.clientHeight}))),n=[],o=0;o<t.el.length;o++){var i={style:"height",start:t.el[o].clientHeight,end:e,unit:"px"};n.push(new Promise(function(e,n){anime(t.el[o],i,100).then(function(){e()})}))}Promise.all(n).then(function(){$$("#rows-container").addClass("stretch");for(var e=0;e<t.el.length;e++)t.el[e].style.height=""})},e.prototype.calc=function(){for(var t=[],e=$$("#rows-container").children(),n=0;n<e.length();n++)t.push(e.el[n].clientHeight);return t.indexOf(Math.min.apply(null,t))},e.prototype.move=function(){$$("#rows-container").children(this.calc()).append(this)},e.prototype.top=function(){return this.offset().top},e}(C);